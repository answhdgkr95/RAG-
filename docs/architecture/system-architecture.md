# 시스템 아키텍처

## 개요

RAG 기반 문서 검색 시스템은 마이크로서비스 아키텍처를 기반으로 설계된 클라우드 네이티브 애플리케이션입니다.

## 전체 아키텍처

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Frontend      │    │   API Gateway   │    │   Backend       │
│   (Next.js)     │────│   (Nginx)       │────│   (FastAPI)     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                                        │
                       ┌─────────────────┐             │
                       │   Vector DB     │             │
                       │   (Milvus)      │─────────────┤
                       └─────────────────┘             │
                                                        │
                       ┌─────────────────┐             │
                       │   Database      │             │
                       │   (PostgreSQL)  │─────────────┤
                       └─────────────────┘             │
                                                        │
                       ┌─────────────────┐             │
                       │   Cache         │             │
                       │   (Redis)       │─────────────┘
                       └─────────────────┘
```

## 핵심 컴포넌트

### 1. 프론트엔드 (Next.js)
- **역할**: 사용자 인터페이스 제공
- **기술**: React 18, Next.js 14, TypeScript
- **기능**:
  - 문서 업로드 인터페이스
  - 검색 쿼리 입력
  - 검색 결과 표시
  - 사용자 인증 및 권한 관리

### 2. 백엔드 API (FastAPI)
- **역할**: 비즈니스 로직 처리 및 API 제공
- **기술**: Python 3.11, FastAPI, SQLAlchemy
- **기능**:
  - RESTful API 서버
  - 문서 처리 및 임베딩
  - RAG 기반 검색 엔진
  - 사용자 인증 및 권한 관리

### 3. 데이터베이스 계층

#### PostgreSQL
- **역할**: 관계형 데이터 저장
- **데이터**:
  - 사용자 정보
  - 문서 메타데이터
  - 검색 히스토리

#### Milvus (Vector Database)
- **역할**: 벡터 임베딩 저장 및 검색
- **데이터**:
  - 문서 청크 임베딩
  - 의미론적 유사도 검색

#### Redis
- **역할**: 캐싱 및 세션 관리
- **데이터**:
  - API 응답 캐시
  - 사용자 세션
  - 임시 데이터

### 4. 외부 서비스

#### OpenAI API
- **역할**: LLM 및 임베딩 서비스
- **사용**:
  - GPT-4 for RAG 응답 생성
  - text-embedding-3 for 문서 임베딩

#### AWS S3
- **역할**: 파일 저장소
- **데이터**:
  - 업로드된 문서 파일
  - 정적 자산

## 데이터 흐름

### 1. 문서 업로드 프로세스
```
1. 사용자 파일 업로드
2. 파일 검증 및 S3 저장
3. 문서 내용 추출
4. 텍스트 청킹
5. 임베딩 생성 (OpenAI)
6. 벡터 DB 저장 (Milvus)
7. 메타데이터 저장 (PostgreSQL)
```

### 2. 검색 프로세스
```
1. 사용자 쿼리 입력
2. 쿼리 임베딩 생성
3. 벡터 유사도 검색 (Milvus)
4. 관련 문서 청크 검색
5. RAG 프롬프트 구성
6. LLM 응답 생성 (OpenAI)
7. 결과 반환 및 캐싱
```

## 보안 아키텍처

### 인증 및 권한
- JWT 기반 인증
- Role-based Access Control (RBAC)
- OAuth 2.0 지원

### 데이터 보안
- HTTPS/TLS 암호화
- 데이터베이스 암호화
- 민감 정보 마스킹

### 인프라 보안
- VPC 네트워크 격리
- Security Groups
- WAF 보호

## 확장성 및 성능

### 수평 확장
- 마이크로서비스 아키텍처
- 컨테이너 기반 배포
- Auto Scaling

### 성능 최적화
- Redis 캐싱
- CDN 활용
- 데이터베이스 최적화

### 모니터링
- Prometheus + Grafana
- 애플리케이션 로그
- 성능 메트릭 수집

## 배포 아키텍처

### 개발 환경
- Docker Compose
- 로컬 개발 서버

### 스테이징/프로덕션
- Kubernetes 클러스터
- Helm Charts
- CI/CD 파이프라인

## 향후 확장 계획

### Phase 2
- 멀티테넌시 지원
- 고급 권한 관리
- 실시간 협업 기능

### Phase 3
- 온프레미스 배포 지원
- 엣지 컴퓨팅 지원
- AI 모델 커스터마이징 